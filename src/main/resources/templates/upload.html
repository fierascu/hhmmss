<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org"
      th:replace="~{layout :: layout(title='Upload Timesheet', content=~{::content})}">

<th:block th:fragment="content">
    <!-- Error Message -->
    <div th:if="${errorMessage}" class="alert alert-error">
        <strong>[ERROR]</strong>
        <span th:text="${errorMessage}"></span>
    </div>

    <!-- Success Message -->
    <div th:if="${successMessage}" class="alert alert-success">
        <strong>[OK]</strong>
        <span th:text="${successMessage}"></span>

        <!-- Show processed files list for ZIP batch processing -->
        <div th:if="${isZipResult}" style="margin-top: 1rem;">
            <div th:if="${processedFiles != null and !#lists.isEmpty(processedFiles)}" style="margin-top: 0.75rem;">
                <strong style="color: #065f46;">Successfully processed files:</strong>
                <ul style="margin: 0.5rem 0; padding-left: 1.25rem; color: #065f46;">
                    <li th:each="file : ${processedFiles}" th:text="${file}"></li>
                </ul>
            </div>

            <div th:if="${failedFiles != null and !#lists.isEmpty(failedFiles)}" style="margin-top: 0.75rem;">
                <strong style="color: #991b1b;">Failed files:</strong>
                <ul style="margin: 0.5rem 0; padding-left: 1.25rem; color: #991b1b;">
                    <li th:each="file : ${failedFiles}" th:text="${file}"></li>
                </ul>
            </div>
        </div>

        <div style="margin-top: 1rem;">
            <!-- ZIP result: Single download button -->
            <a th:if="${isZipResult}" th:href="@{'/files/' + ${extractedFilename}}" class="btn btn-success">
                Download All Timesheets (ZIP)
            </a>

            <!-- Single file result: Multiple download buttons for DOCX and PDFs -->
            <div th:if="${!isZipResult}">
                <a th:href="@{'/files/' + ${extractedFilename}}" class="btn btn-success">
                    Download Timesheet (DOCX)
                </a>
                <a th:if="${docPdfFilename}" th:href="@{'/files/' + ${docPdfFilename}}" class="btn btn-primary" style="margin-left: 0.5rem;">
                    Download Timesheet (PDF)
                </a>
                <a th:if="${xlsPdfFilename}" th:href="@{'/files/' + ${xlsPdfFilename}}" class="btn btn-secondary" style="margin-left: 0.5rem;">
                    Download Input Excel (PDF)
                </a>
            </div>
        </div>
    </div>

    <!-- Upload Form -->
    <form action="/" enctype="multipart/form-data" method="POST">
        <div class="form-group">
            <label for="fileInput">Select Excel Timesheet or ZIP file</label>
            <input id="fileInput" name="file" type="file"
                   accept=".xls,.xlsx,.xlsm,.xlsb,.zip"/>
        </div>
        <button id="uploadButton" type="submit" class="btn btn-primary" disabled>
            Upload and Convert
        </button>
    </form>

    <script>
        document.getElementById('fileInput').addEventListener('change', function() {
            var uploadButton = document.getElementById('uploadButton');
            var file = this.files[0];

            if (!file) {
                uploadButton.disabled = true;
                return;
            }

            // Check if the file has an Excel or ZIP extension
            var fileName = file.name.toLowerCase();
            var isValidFile = fileName.endsWith('.xls') ||
                             fileName.endsWith('.xlsx') ||
                             fileName.endsWith('.xlsm') ||
                             fileName.endsWith('.xlsb') ||
                             fileName.endsWith('.zip');

            uploadButton.disabled = !isValidFile;
        });
    </script>

    <!-- File List -->
    <div th:if="${files != null and !#lists.isEmpty(files)}" class="file-list">
        <h3>Previously Converted Files</h3>
        <ul>
            <li th:each="file : ${files}">
                <a th:href="${file}" th:text="${file}"></a>
            </li>
        </ul>
    </div>
</th:block>

</html>
